{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Available Jobs | JobBoard</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
  <header class="navbar">
    <div class="logo">JDP<span>Jobs</span></div>
    <nav>
      <ul>
        <li><a href="{% url 'home' %}">Home</a></li>
        <li><a href="{% url 'job_list' %}" class="active">Jobs</a></li>
        <li><a href="#">About</a></li>
        {% if user.is_authenticated %}
          <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
          <li><a href="{% url 'logout' %}">Logout</a></li>
        {% else %}
          <li><a href="{% url 'login' %}">Login</a></li>
          <li><a href="{% url 'register' %}">Register</a></li>
        {% endif %}
      </ul>
    </nav>
  </header>

  <div class="container">
    <h1 class="page-title">Available Jobs</h1>
    
    <!-- Search and Filters Section -->
    <div class="search-filters">
      <form method="GET" action="{% url 'job_list' %}" class="search-form">
        <div class="search-bar">
          <input type="text" name="q" placeholder="Search jobs by title, company, or keywords..." 
                 value="{{ search_query }}" class="search-input">
          <button type="submit" class="search-btn">
            <i class="search-icon">üîç</i> Search
          </button>
        </div>
        
        <div class="filter-row">
          <div class="filter-group">
            <label>Job Type:</label>
            <select name="job_type" class="filter-select">
              <option value="">All Job Types</option>
              {% for value, label in job_types %}
                <option value="{{ value }}" {% if selected_job_type == value %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
          </div>
          
          <div class="filter-group">
            <label>Location:</label>
            <select name="location" class="filter-select">
              <option value="">All Locations</option>
              {% for loc in locations %}
                <option value="{{ loc }}" {% if selected_location == loc %}selected{% endif %}>
                  {{ loc }}
                </option>
              {% endfor %}
            </select>
          </div>
          
          <div class="filter-actions">
            <button type="submit" class="btn btn-primary">Apply Filters</button>
            <a href="{% url 'job_list' %}" class="btn btn-outline-primary">Clear All</a>
          </div>
        </div>
      </form>
    </div>

    <!-- Results Count -->
    <div class="results-info">
      <p>Found <strong>{{ jobs.count }}</strong> job{{ jobs.count|pluralize }} matching your criteria</p>
      {% if search_query or selected_job_type or selected_location %}
        <div class="active-filters">
          <strong>Active filters:</strong>
          {% if search_query %}<span class="filter-tag">Search: "{{ search_query }}"</span>{% endif %}
          {% if selected_job_type %}<span class="filter-tag">Type: {{ selected_job_type|title }}</span>{% endif %}
          {% if selected_location %}<span class="filter-tag">Location: {{ selected_location }}</span>{% endif %}
        </div>
      {% endif %}
    </div>

    <!-- Post Job Button -->
    {% if user.is_authenticated %}
      <div class="post-job-section">
        <a href="{% url 'post_job' %}" class="btn btn-primary">+ Post a Job</a>
      </div>
    {% else %}
      <div class="post-job-section">
        <a href="{% url 'login' %}" class="btn btn-primary">Login to Post a Job</a>
      </div>
    {% endif %}

    <!-- Job Listings -->
    <div class="job-list">
      {% for job in jobs %}
        <div class="job-card">
          <div class="job-header">
            <h3>{{ job.title }}</h3>
            <span class="job-type job-type-{{ job.job_type }}">{{ job.get_job_type_display }}</span>
          </div>
          <p class="company-location">
            <strong>{{ job.company }}</strong> ‚Ä¢ {{ job.location }}
          </p>
          <p class="job-description">{{ job.description|truncatewords:30 }}</p>
          <div class="job-meta">
            <span class="salary">{% if job.salary %}üíµ ${{ job.salary }}{% else %}üíµ Salary not specified{% endif %}</span>
            <span class="post-date">üìÖ {{ job.date_posted|date:"M d, Y" }}</span>
          </div>
          <div class="job-actions">
            <a href="{% url 'job_detail' job.id %}" class="btn btn-outline-primary">View Details</a>
            {% if user.is_authenticated and user != job.posted_by %}
              <a href="{% url 'apply_job' job.id %}" class="btn btn-primary">Apply Now</a>
            {% elif not user.is_authenticated %}
              <a href="{% url 'login' %}" class="btn btn-primary">Login to Apply</a>
            {% endif %}
          </div>
        </div>
      {% empty %}
        <div class="no-jobs">
          <h3>No jobs found</h3>
          <p>No jobs match your search criteria. Try adjusting your filters or search terms.</p>
          {% if user.is_authenticated %}
            <a href="{% url 'post_job' %}" class="btn btn-primary">Be the first to post a job!</a>
          {% else %}
            <a href="{% url 'register' %}" class="btn btn-primary">Register to post jobs</a>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>

  <footer>
    <p>¬© 2025 JobBoard. Crafted with üíô by Sofia.</p>
  </footer>
</body>
</html>